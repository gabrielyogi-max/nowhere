<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>OrbitOS - AI Chat</title>
    <style>
        body { background: #1a1a1a; color: #fff; font-family: sans-serif; padding: 20px; }
        .box { max-width: 600px; margin: 0 auto; }
        select, input, button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 5px; border: none; }
        button { background: #00ff88; color: #000; font-weight: bold; cursor: pointer; }
        button:hover { background: #00cc6a; }
        #chat-history { background: #2d2d2d; height: 300px; overflow-y: scroll; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
        .msg { margin: 5px 0; padding: 8px; border-radius: 5px; }
        .user { background: #444; text-align: right; }
        .bot { background: #0055ff; }
    </style>
</head>
<body>

<div class="box">
    <h1>ü™ê OrbitOS AI</h1>
    
    <select id="modelSelector">
        <option value="‚òÅÔ∏è Groq: Llama 3.1 70B (Inteligente & R√°pido)">‚òÅÔ∏è Llama 3.1 70B (R√°pido)</option>
        <option value="‚òÅÔ∏è Groq: Llama 3.1 8B (Flash - Muito R√°pido)">‚ö° Llama 3.1 8B (Flash)</option>
        <option value="‚òÅÔ∏è Groq: Mixtral 8x7B (MoE)">üß† Mixtral 8x7B</option>
        <option value="üî• Local H200: Qwen 2.5 Coder 32B (Gasta Cota!)">üî• Qwen Coder (H200)</option>
    </select>

    <div id="chat-history"></div>

    <input type="text" id="userInput" placeholder="Digite sua mensagem..." />
    <button onclick="sendMessage()" id="sendBtn">Enviar</button>
    <p id="status" style="font-size: 0.8em; color: #888;"></p>
</div>

<script type="module">
    import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/+esm";

    let client;
    const statusText = document.getElementById('status');
    const historyDiv = document.getElementById('chat-history');

    // 1. Conecta na API assim que a p√°gina abre
    async function connectAPI() {
        statusText.innerText = "üõ∞Ô∏è Conectando ao APIDOST...";
        try {
            // Conecta no seu Space
            client = await Client.connect("Madras1/APIDOST");
            statusText.innerText = "‚úÖ Conectado ao Sistema Neural.";
        } catch (error) {
            statusText.innerText = "‚ùå Erro ao conectar: " + error.message;
            console.error(error);
        }
    }

    // Chama a conex√£o inicial
    connectAPI();

    // 2. Fun√ß√£o de Enviar
    window.sendMessage = async function() {
        const input = document.getElementById('userInput');
        const modelSelect = document.getElementById('modelSelector');
        const userText = input.value;
        
        if (!userText || !client) return;

        // Adiciona mensagem do usu√°rio na tela
        appendMessage("user", userText);
        input.value = "";
        statusText.innerText = "ü§î Processando...";

        try {
            // A M√°gica acontece aqui: chama a fun√ß√£o 'predict'
            const result = await client.predict("/chat", { 
                message: userText,
                model_selector: modelSelect.value // Manda o modelo escolhido
            });

            // O resultado vem dentro de 'data'
            const botResponse = result.data[0];
            appendMessage("bot", botResponse);
            statusText.innerText = "‚úÖ Pronto.";

        } catch (error) {
            statusText.innerText = "‚ùå Erro na resposta.";
            appendMessage("bot", "Erro: " + error.message);
        }
    }

    function appendMessage(role, text) {
        const div = document.createElement('div');
        div.className = "msg " + role;
        div.innerText = text;
        historyDiv.appendChild(div);
        historyDiv.scrollTop = historyDiv.scrollHeight; // Rola pra baixo
    }
</script>

</body>
</html>
